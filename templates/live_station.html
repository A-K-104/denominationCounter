<!DOCTYPE html>
<link rel="stylesheet" type="text/css" href="/static/styles/styles.css">
<html lang="en-US">
{% block content %}

<body>
<h1>Live station {{stationId}}</h1>
<div>
    <table id="ta">
        <tr>

            {%for teamId in range(2)%}
            <th>team id</th>
            <th>team name</th>
            <th>take control</th>
            {%endfor%}
        </tr>

        {%for teamId in range(((teams|length)/2)|int)%}
        <tr>

            <td {%if teamInControl==teams[teamId].id%} style="background-color: {{teams[teamId].color}};" {%endif%}>
                <p style="color:{{teams[teamId].color}};">{{teams[teamId].id}}</p>
            </td>
            <td {%if teamInControl==teams[teamId].id%} style="background-color: {{teams[teamId].color}};" {%endif%}>
                <p style="color:{{teams[teamId].color}};">
                    {{teams[teamId].name}}</p>
            </td>
            <td {%if teamInControl==teams[teamId].id%} style="background-color: {{teams[teamId].color}};" {%endif%}>
                <form action="/live-station?session-id={{sessionId}}&station-id={{stationId}}" method="post">
                    <button name="setStatus"
                            style="background-color: {{teams[teamId].color}}; height: 200px; width: 200px;"
                            value={{teams[teamId].id}}>take
                        >take
                        control
                    </button>
                </form>
            </td>

            <td {%if teamInControl==teams[(teams|length)-1-teamId].id%}
                style="background-color: {{teams[(teams|length)-1-teamId].color}};" {%endif%}>
                <p style="color:{{teams[(teams|length)-1-teamId].color}};">{{teams[(teams|length)-teamId-1].id}}</p>
            </td>
            <td {%if teamInControl==teams[(teams|length)-1-teamId].id%}
                style="background-color: {{teams[(teams|length)-1-teamId].color}};" {%endif%}>
                <p style="color:{{teams[(teams|length)-teamId-1].color}};">
                    {{teams[(teams|length)-teamId-1].name}}</p>
            </td>
            <td {%if teamInControl==teams[(teams|length)-1-teamId].id%}
                style="background-color: {{teams[(teams|length)-1-teamId].color}};" {%endif%}>
                <form action="/live-station?session-id={{sessionId}}&station-id={{stationId}}" method="post">
                    <button name="setStatus"
                            style="background-color: {{teams[(teams|length)-teamId-1].color}}; height: 200px; width: 200px;"
                            value={{teams[(teams|length)-teamId-1].id}}>take
                        control
                    </button>
                </form>
            </td>
        </tr>
        {%endfor%}
    </table>
</div>
{{message}}
</body>
{% endblock %}
<script>
    const interval = setInterval(function () {
        fetch('/game-is-alive'+ window.location.search)
            .then((response) => {
                console.log(response)
                // debugger
                const table = document.querySelector("#ta");
                if (response.status === 202) {
                    table.hidden = false

                    let children = table.children
                    Array.from(children[0].children).forEach(child =>
                        Array.from(child.children).forEach(subChild =>
                            subChild.style.background = "#FFFFFF")
                    )
                }
            })

    }, 2000);
</script>

</html>